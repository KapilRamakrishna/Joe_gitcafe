//Gets the browser specific XmlHttpRequest Object
function getXmlHttpRequestObject() {
	if (window.XMLHttpRequest) {
		return new XMLHttpRequest();
	} else if(window.ActiveXObject) {
		return new ActiveXObject("Microsoft.XMLHTTP");
	} else {
		alert("Your Browser Sucks!\nIt's about time to upgrade don't you think?");
	}
}

//Our XmlHttpRequest object to get the auto suggest
var searchReq = getXmlHttpRequestObject();

//Starts the AJAX request.
var sType="";
function searchSuggest(aType='') {
	sType = aType;
	document.getElementById("search_suggest").style.display = "block";
	if (searchReq.readyState == 4 || searchReq.readyState == 0) {
		var str = escape(document.getElementById('txtSearch' + sType).value);
		var catsid = document.getElementById('catsid').value;
		console.log(sType + 'test');


		searchReq.open("GET", 'version3/searchSuggest.php?search=' + str +'&categories_id='+ catsid, true);
		searchReq.onreadystatechange = handleSearchSuggest;
		searchReq.send(null);
	}
}

//Called when the AJAX response is returned.
function handleSearchSuggest() {
	if (searchReq.readyState == 4) {
		var sID = 'search_suggest' + sType;
		var ss = document.getElementById(sID)
		console.log(sType + 'BTTT');

		ss.innerHTML = '';
		
		var str = searchReq.responseText.split("\n");
		
		for(i=0; i < str.length - 1; i++) {
			//Build our element string.  This is cleaner using the DOM, but
			//IE doesn't support dynamically added attributes.
			if(str[i] ==''){
				document.getElementById(sID).style.display = "none";
			}else {
				document.getElementById(sID).style.display = "block";
			}
			if(str[i] !=''){
			var suggest = '<div tabindex="i" onmouseover="javascript:suggestOver(this);" ';
			suggest += 'onmouseout="javascript:suggestOut(this);" ';
			//suggest += 'onclick="javascript:setSearch(this.innerHTML);" ';
			suggest += 'onclick="window.location.href=\'/advanced_search_result.php?keywords=\'+this.innerHTML"';
			suggest += 'class="suggest_link"">' + str[i] + '</div>';
			ss.innerHTML += suggest;
			}
			
		}
	}
}

//Mouse over function
function suggestOver(div_value) {
	div_value.className = 'suggest_link_over';
}
//Mouse out function
function suggestOut(div_value) {
	div_value.className = 'suggest_link';
	}
//Click function
function setSearch(value) {
	document.getElementById('search_suggest').innerHTML = '';
	document.getElementById('txtSearch').value = stripHTML(value);
	document.getElementById('frmSearch').submit();
}
function stripHTML(str){ 
    return str.replace(/<[^>]*>/g, "");
}